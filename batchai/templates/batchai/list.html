<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Inference Requests</title>
  <style>
    body {
      font-size: 14px;
      margin: 10px;
      line-height: 1.5;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      vertical-align: top;
      word-wrap: break-word;
    }
    th {
      background-color: #f4f4f4;
      font-weight: bold;
    }
    .truncate {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: block;
    }
    .details-link {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .expandedText {
      background-color: #333;
      color: #fff;
      /* text-align: center; */
      border-radius: 6px;
      padding: 5px;
      /* position: absolute; */
      z-index: 1;
      bottom: 125%;
      left: 50%;
      /* margin-left: -100px; */
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      white-space: normal;
      display: none;
    }

    #expandedMainText {
      padding: 5px;
      font-size: 14px;
      font-family: monospace;
      white-space: normal;
    }

    .expanded .truncatedText {
     display: none;
    }

    .expanded .expandedText {
      visibility: visible !important;
      opacity: 1;
      display: block;
    }
  </style>
</head>
<body>
  <h1>Text Inference Requests</h1>
  <div style="text-align: right; font-size: 20px;">
    <a href="{% url 'batchai:submit_request' %}" class="admin-link">Submit</a> |
    <a href="{% url 'admin:batchai_textinferencerequest_add' %}" class="admin-link">Admin</a>
  </div>
  <table id="mainTable">
    <thead>
      <tr>
        <th>Datetime</th>
        <th>Purpose</th>
        <th>User Prompt</th>
        <th>Results</th>
        <th>Status</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      {% for req in items %}
      <tr>
        <td>{{ req.created|date:"Y-m-d H:i" }}</td>
        <td>{{ req.purpose }}</td>
        <td>
          <div class="" onclick="toggleExpand(this)">
            <span class="truncatedText">
              {{ req.user_prompt|truncatechars:50 }}
            </span>
            <span class="expandedText">{{ req.user_prompt|linebreaksbr }}</span>
          </div>
        </td>
        <td>
          <span class="" onclick="toggleExpand(this)">
            <span class="truncatedText">
              {{ req.result|truncatechars:50 }}
            </span>
            <span class="expandedText">{{ req.result|linebreaksbr }}</span>
          </span>
	  - <span class="expandOneAction" onclick="toggleExpandOne(this)">Expand</span>
        </td>
        <td>{{ req.status }}</td>
        <td><a href="{% url 'admin:batchai_textinferencerequest_change' req.id %}" class="admin-link">View</a></td>
      </tr>
      {% empty %}
      <tr><td colspan="6">No requests found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="paginate-arrows">
      <span style="float:left">{{ items.previous_a_start }}《《{{ items.previous_a_end }}</span>
      <span style="float:right">{{ items.next_a_start }}》》{{ items.next_a_end }}</span>
      &nbsp;
  </div>
  <div id="expandedMainText">
  </div>
  <script>
    function toggleExpand(element) {
      const p = element.parentElement;
      if (p.classList.contains('expanded')) {
        p.classList.remove('expanded');
      } else {
        p.classList.add('expanded');
        console.log(p);
      }
    }
    function toggleExpandOne(element) {
      const mainText = document.getElementById("expandedMainText");
      const p = element.parentElement;
      const t = p.querySelector(".expandedText").innerHTML;
      mainText.innerHTML = t;
	    console.log(t);
    }
  </script>
</body>
</html>
